webpackJsonp([20],{"HeT/":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={props:{payments:{type:[Array,Object],default:function(){return[]}},user:{type:Object,default:function(){return{}}}},methods:{payment:function(t){this.$emit("pay",t)}}},i={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.payments.length?r("div",t._l(t.payments,function(e,i){return r("div",{key:i,staticClass:"payment",on:{click:function(a){return t.payment(e.code)}}},[r("img",{staticClass:"payment-img",attrs:{src:e.img}}),t._v(" "),r("div",{staticClass:"payment-left"},[r("h3",[t._v(t._s(e.name))]),t._v(" "),"balancepay"===e.code?r("p",[t._v("当前余额: "+t._s(t.user.balance))]):r("p",[t._v(t._s(e.memo))])]),t._v(" "),r("img",{staticClass:"right-img",attrs:{src:a("oenc")}})])}),0):t._e()},staticRenderFns:[]};var n={components:{payment:a("C7Lr")(r,i,!1,function(t){a("s8Sz")},null,null).exports},inject:["reload"],data:function(){return{orderId:this.$route.query.order_id,order_amount:"",payments:[],userInfo:{},popShow:!1,pay_type:this.$route.query.pay_type,payname:"",timer:""}},created:function(){var t=this;this.orderDetail(),this.getPaymentType(),this.getUserInfo(),""!=this.pay_type?"weixin"==this.pay_type?(this.payname="微信支付",this.paymentedHandle()):"alipay"==this.pay_type&&(this.payname="支付宝支付",this.paymentedHandle()):this.popShow&&(this.popShow=!1),this.timer=setInterval(function(){t.getOrderInfo()},1e3)},methods:{orderDetail:function(){var t=this;this.$api.orderDetail({order_id:this.orderId},function(e){t.order_amount=e.data.order_amount})},getPaymentType:function(){var t=this;this.$api.paymentList({},function(e){var a=e.data;for(var r in a)a[r].img="./static/image/"+a[r].code+".png";t.payments=a})},getUserInfo:function(){var t=this;this.$api.userInfo({},function(e){e.status&&(t.userInfo=e.data)})},pay:function(t){var e=this;if("wechatpay"===t)if(this.GLOBAL.isWeiXinBrowser()){var a={ids:this.orderId,payment_code:t,payment_type:1,params:{trade_type:"JSAPI_OFFICIAL"}};this.$api.pay(a,function(t){if(t.status){var a=t.data,r=e;WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:a.appid,timeStamp:a.timeStamp,nonceStr:a.nonceStr,package:a.package,signType:a.signType,paySign:a.paySign},function(t){"get_brand_wcpay_request:ok"===t.err_msg&&r.$router.replace({path:"/payresult",query:{order_id:r.orderId}})})}})}else{var r={ids:this.orderId,payment_code:t,payment_type:1,params:{trade_type:"MWEB",return_url:this.GLOBAL.locationHost()+"/#/cashierdesk?order_id="+this.orderId+"&pay_type=weixin"}};this.$api.pay(r,function(t){t.status?(e.pay_type="weixin",location.href=t.data.mweb_url):e.$dialog.alert({mes:t.msg})})}else if("alipay"===t){var i={ids:this.orderId,payment_code:t,payment_type:1,params:{trade_type:"WAP",return_url:this.GLOBAL.locationHost()+"/#/cashierdesk?order_id="+this.orderId+"&pay_type=alipay"}};this.$api.pay(i,function(t){t.status&&e.StandardPost(t.data.url,t.data.data)})}else if("balancepay"===t){var n={ids:this.orderId,payment_code:t,payment_type:1};this.$api.pay(n,function(t){t.status&&e.$router.replace({path:"/payresult",query:{order_id:e.orderId}})})}else"offline"===t&&this.$dialog.confirm({title:"线下支付说明",mes:"请联系客服进行线下支付",opts:[{txt:"订单详情",color:!1,callback:function(){e.$router.push({path:"/orderdetail",query:{order_id:e.orderId}})}},{txt:"继续购物",color:!0,callback:function(){e.$router.push("/index")}}]})},getOrderInfo:function(){var t=this,e={order_id:this.orderId};this.$api.orderDetail(e,function(e){t.orderInfo=e.data,2===t.orderInfo.pay_status&&(clearInterval(t.timer),t.$router.replace({path:"/payresult",query:{order_id:t.orderId}}))})},StandardPost:function(t,e){var a=document.createElement("form");a.id="aliPay",a.methods="post",a.action=t,a.target="_self";var r=[];for(var i in e)r[i]=document.createElement("input"),r[i].type="hidden",r[i].name=i,r[i].value=e[i],a.appendChild(r[i]);a.addEventListener("submit",function(){},!1),document.body.appendChild(a),a.dispatchEvent(new Event("submit")),a.submit(),document.body.removeChild(a)},paymentedHandle:function(){this.popShow=!0},completed:function(){this.popShow=!1,this.$router.replace({path:"/payresult",query:{order_id:this.orderId}})},heavyLoad:function(){this.popShow=!1,this.$router.replace({path:"/cashierdesk",query:{order_id:this.orderId}})}},watch:{pay_type:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){"weixin"===pay_type&&(this.payname="微信支付"),"alipay"===pay_type&&(this.payname="支付宝支付"),this.paymentedHandle()})}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"cashierdesk"},[a("yd-cell-group",[a("yd-cell-item",[a("span",{attrs:{slot:"left"},slot:"left"},[t._v("订单编号")]),t._v(" "),a("span",{attrs:{slot:"right"},slot:"right"},[t._v(t._s(t.orderId))])]),t._v(" "),a("yd-cell-item",[a("span",{attrs:{slot:"left"},slot:"left"},[t._v("订单金额")]),t._v(" "),a("span",{attrs:{slot:"right"},slot:"right"},[t._v("￥"+t._s(t.order_amount))])])],1),t._v(" "),a("payment",{attrs:{payments:t.payments,user:t.userInfo},on:{pay:t.pay}}),t._v(" "),a("yd-popup",{staticClass:"payresult",attrs:{position:"center",width:"70%","close-on-masker":!1},model:{value:t.popShow,callback:function(e){t.popShow=e},expression:"popShow"}},[a("div",[a("div",{staticClass:"payresult-i"},[t._v("请确认 "+t._s(t.payname)+" 是否已完成")]),t._v(" "),a("div",{staticClass:"payresult-i",on:{click:t.completed}},[t._v("已完成支付")]),t._v(" "),a("div",{staticClass:"payresult-i",on:{click:t.heavyLoad}},[t._v("支付遇到问题,重新支付")])])])],1)},staticRenderFns:[]};var o=a("C7Lr")(n,s,!1,function(t){a("rAh0")},null,null);e.default=o.exports},rAh0:function(t,e){},s8Sz:function(t,e){}});
//# sourceMappingURL=20.c215a721660beaf7dee1.js.map